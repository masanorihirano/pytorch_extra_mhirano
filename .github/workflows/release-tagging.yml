name: Release tagging
on:
 pull_request:
   branches:
     - main
   types:
     - closed
jobs:
 main:
   runs-on: ubuntu-latest
   if: github.event.pull_request.merged == true && startsWith(github.event.pull_request.head.ref, 'release/')
   steps:
     - uses: actions/checkout@v2
     - run: git config --global user.email "masa.hirano.1996@gmail.com"
     - run: git config --global user.name "Masanori HIRANO"
     - run: git fetch origin ${{ github.event.pull_request.head.ref }}
     - run: git checkout main
     - run: git tag -a `echo '${{ github.event.pull_request.head.ref }}' | sed 's/release\///'` -m 'This release is automatically generated. Please see the pull request. ${{ github.event.pull_request.html_url }}'
     - run: git push origin `echo '${{ github.event.pull_request.head.ref }}' | sed 's/release\///'`
     - run: git push --delete origin ${{ github.event.pull_request.head.ref }}
